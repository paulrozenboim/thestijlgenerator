<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Stilj Generator</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="main-content">
        <h1 id="mainTitle">The Stilj Generator</h1>
        
        <div id="controls">
            <select id="sketchSelect" onchange="loadSketch()">
                <option value="1">Basic Shape Drawing</option>
                <option value="2">Letter Typography Explorer</option>
                <option value="3">Mondrian Collage</option>
                <option value="4">Magnetic Letter Field</option>
                <option value="5">Dynamic Pattern Rectangles</option>
                <option value="6">Zero Gravity Type</option>
                <option value="7">Generative Color Burst</option>
                <option value="8">Letter Gravity Field</option>
                <option value="9">Shape Trails</option>
                <option value="10">Mondrian Pixels</option>
            </select>
            
            <div class="button-row">
                <button onclick="clearCanvas()" title="Clear">🧽</button>
                <button onclick="saveCanvasImage()" title="Save PNG (Press S)">💾</button>
                <button onclick="toggleFullscreen()" id="fullscreenBtn" title="Toggle Fullscreen">⛶</button>
                <button onclick="testDraw()" title="Test Draw">🎨</button>
            </div>
        </div>

        <div id="sketchInfo">
            <div id="sketchTitle">Basic Shape Drawing</div>
            <div id="sketchDescription">Click to draw basic shapes with Mondrian colors</div>
        </div>

        <div id="canvasArea">
            <!-- p5.js canvas goes here -->
        </div>
    </div>

    <footer>
        <div><a href="http://www.unapaulogetic.art/">by @unapaulogetic</a></div>
    </footer>

    <script src="lib/p5.js"></script>
    
    <!-- Load sketch files -->
    <script src="sketches/sketch1.js"></script>
    <script src="sketches/sketch2.js"></script>
    <script src="sketches/sketch3.js"></script>
    <script src="sketches/sketch4.js"></script>
    <script src="sketches/sketch5.js"></script>
    <script src="sketches/sketch6.js"></script>
    <script src="sketches/sketch7.js"></script>
    <script src="sketches/sketch8.js"></script>
    <script src="sketches/sketch9.js"></script>
    <script src="sketches/sketch10.js"></script>
    
    <script>
        // Fonts and colors for title
        const titleFonts = ["Arial", "Helvetica", "Verdana", "Tahoma", "Trebuchet MS", "Gill Sans", "Arial Black", "Impact"];
        const mondrianColors = ["#FEB400", "#155498", "#018C34", "#D5311F", "#000000", "#FFFFFF"];
        
        // Style each letter individually
        function styleIndividualLetters() {
            const titleElement = document.getElementById('mainTitle');
            const titleText = "The Stilj Generator";
            
            // Clear the title and build it letter by letter
            titleElement.innerHTML = '';
            
            for (let i = 0; i < titleText.length; i++) {
                const char = titleText[i];
                const span = document.createElement('span');
                span.textContent = char;
                
                // Skip styling for spaces
                if (char !== ' ') {
                    // Random font
                    const randomFont = titleFonts[Math.floor(Math.random() * titleFonts.length)];
                    
                    // Random Mondrian color (excluding white for better visibility)
                    const colorsWithoutWhite = mondrianColors.filter(color => color !== "#FFFFFF");
                    const randomColor = colorsWithoutWhite[Math.floor(Math.random() * colorsWithoutWhite.length)];
                    
                    // Apply styles
                    span.style.fontFamily = randomFont;
                    span.style.color = randomColor;
                    span.style.webkitTextStroke = '1pt #000000';
                    span.style.textStroke = '1pt #000000';
                    span.style.display = 'inline-block';
                    
                    // Optional: Add slight random rotation for more chaos
                    const randomRotation = (Math.random() - 0.5) * 10;
                    span.style.transform = `rotate(${randomRotation}deg)`;
                } else {
                    // For spaces, just add some width
                    span.style.display = 'inline-block';
                    span.style.width = '0.3em';
                }
                
                titleElement.appendChild(span);
            }
            
            console.log("Title letters styled individually!");
        }
        
        // Call it when page loads
        styleIndividualLetters();

        // Optional: Click title to re-randomize
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('mainTitle').addEventListener('click', styleIndividualLetters);
        });

        // Simple global variables
        let currentSketch = 1;
        let canvas;
        let letters = [];
        let shapes = [];
        let lettersList = [];
        let startX = 0, startY = 0;
        let isDrawing = false;
        let fonts = ["Arial", "Helvetica", "Verdana", "Tahoma", "Trebuchet MS", "Gill Sans", "Arial Black", "Impact"];
        let isFullscreen = false;

        const MONDRIAN_COLORS = ["#FEB400", "#155498", "#018C34", "#D5311F", "#000000", "#FFFFFF"];
        
        const sketchData = {
            1: { title: "Basic Shape Drawing", description: "Click to draw basic shapes with Mondrian colors" },
            2: { title: "Letter Typography Explorer", description: "Click to place letters with random fonts and styles" },
            3: { title: "Mondrian Collage", description: "Drag to create grid-snapping rectangles with Mondrian colors" },
            4: { title: "Magnetic Letter Field", description: "Drag to create floating letters attracted to your mouse" },
            5: { title: "Dynamic Pattern Rectangles", description: "Drag to create textured rectangles with varied patterns" },
            6: { title: "Zero Gravity Type", description: "Drag to create bouncing, spinning letters with physics" },
            7: { title: "Generative Color Burst", description: "Press and hold to grow lines, release for burst effect" },
            8: { title: "Letter Gravity Field", description: "Drag to create letters that fall and bounce with gravity" },
            9: { title: "Shape Trails", description: "Drag to leave a trail of shapes cycling through types" },
            10: { title: "Mondrian Pixels", description: "Drag to place pixels, use scroll wheel to adjust cell size" }
        };

        // Simple canvas setup with enhanced debugging
        function setup() {
            console.log("🚀 p5.js setup() starting...");
            
            updateCanvasSize();
            console.log("Canvas dimensions calculated:", canvasWidth, "x", canvasHeight);
            
            canvas = createCanvas(canvasWidth, canvasHeight);
            console.log("Canvas created");
            
            canvas.parent("canvasArea");
            console.log("Canvas attached to canvasArea");
            
            background("#FFFFFF");
            console.log("Background set to white");
            
            // Mobile optimizations
            setupMobileOptimizations();
            
            // Test if we can draw immediately
            fill('green');
            circle(50, 50, 30);
            console.log("✅ Green test circle drawn at (50,50)");
            
            console.log("🎉 Setup complete! Canvas:", canvasWidth, "x", canvasHeight);
        }

        // Update canvas size based on fullscreen state
        let canvasWidth, canvasHeight;
        function updateCanvasSize() {
            if (isFullscreen) {
                canvasWidth = window.innerWidth;
                canvasHeight = window.innerHeight;
            } else {
                // Simplified sizing for mobile
                const isMobile = window.innerWidth <= 768;
                
                if (isMobile) {
                    // Simple mobile sizing
                    canvasWidth = window.innerWidth - 30; // Account for margins
                    canvasHeight = Math.max(300, window.innerHeight * 0.5); // At least 300px high
                } else {
                    // Desktop sizing
                    canvasWidth = Math.min(window.innerWidth - 100, 900);
                    canvasHeight = Math.min(window.innerHeight - 300, 600);
                }
            }
        }

        // Fullscreen functionality
        function toggleFullscreen() {
            const canvasArea = document.getElementById('canvasArea');
            const fullscreenBtn = document.getElementById('fullscreenBtn');
            
            if (!isFullscreen) {
                // Enter fullscreen
                if (canvasArea.requestFullscreen) {
                    canvasArea.requestFullscreen();
                } else if (canvasArea.webkitRequestFullscreen) {
                    canvasArea.webkitRequestFullscreen();
                } else if (canvasArea.msRequestFullscreen) {
                    canvasArea.msRequestFullscreen();
                }
                
                isFullscreen = true;
                // Keep same icon since user won't see it in fullscreen
                fullscreenBtn.title = "Exit Fullscreen";
                
                // Update canvas size for fullscreen
                setTimeout(() => {
                    updateCanvasSize();
                    resizeCanvas(canvasWidth, canvasHeight);
                    background("#FFFFFF");
                }, 100);
                
            } else {
                // Exit fullscreen
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                } else if (document.webkitExitFullscreen) {
                    document.webkitExitFullscreen();
                } else if (document.msExitFullscreen) {
                    document.msExitFullscreen();
                }
                
                isFullscreen = false;
                // Icon stays the same
                fullscreenBtn.title = "Toggle Fullscreen";
                
                // Update canvas size for normal view
                setTimeout(() => {
                    updateCanvasSize();
                    resizeCanvas(canvasWidth, canvasHeight);
                    background("#FFFFFF");
                }, 100);
            }
        }

        // Listen for fullscreen changes
        document.addEventListener('fullscreenchange', handleFullscreenChange);
        document.addEventListener('webkitfullscreenchange', handleFullscreenChange);
        document.addEventListener('msfullscreenchange', handleFullscreenChange);

        function handleFullscreenChange() {
            if (!document.fullscreenElement && !document.webkitFullscreenElement && !document.msFullscreenElement) {
                // Exited fullscreen
                isFullscreen = false;
                // Icon stays the same
                document.getElementById('fullscreenBtn').title = "Toggle Fullscreen";
                
                setTimeout(() => {
                    updateCanvasSize();
                    resizeCanvas(canvasWidth, canvasHeight);
                    background("#FFFFFF");
                }, 100);
            }
        }

        // Keyboard functionality - Save with 'S' key
        document.addEventListener('keydown', function(event) {
            // Check if 'S' key is pressed (case insensitive)
            if (event.key.toLowerCase() === 's' && !event.ctrlKey && !event.metaKey && !event.altKey) {
                // Prevent default browser behavior
                event.preventDefault();
                
                // Save canvas image
                saveCanvasImage();
                
                // Visual feedback
                console.log("Screenshot saved!");
                
                // Optional: Show brief visual confirmation
                showSaveConfirmation();
            }
        });

        // Show save confirmation
        function showSaveConfirmation() {
            // Create temporary notification
            const notification = document.createElement('div');
            notification.textContent = '💾 Screenshot Saved!';
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #fac901;
                color: #000;
                padding: 10px 20px;
                border-radius: 5px;
                font-family: Verdana, sans-serif;
                font-weight: bold;
                z-index: 1000;
                animation: fadeInOut 2s ease-in-out;
            `;
            
            // Add CSS animation
            const style = document.createElement('style');
            style.textContent = `
                @keyframes fadeInOut {
                    0% { opacity: 0; transform: translateY(-20px); }
                    20% { opacity: 1; transform: translateY(0); }
                    80% { opacity: 1; transform: translateY(0); }
                    100% { opacity: 0; transform: translateY(-20px); }
                }
            `;
            document.head.appendChild(style);
            
            document.body.appendChild(notification);
            
            // Remove notification after animation
            setTimeout(() => {
                document.body.removeChild(notification);
                document.head.removeChild(style);
            }, 2000);
        }

        // Simple draw loop
        function draw() {
            switch(currentSketch) {
                case 2: if (typeof drawLetterTypography === 'function') drawLetterTypography(); break;
                case 4: if (typeof drawMagneticLetters === 'function') drawMagneticLetters(); break;
                case 5: 
                    if (isDrawing) background("#FFFFFF");
                    if (typeof redrawPatternGrid === 'function') redrawPatternGrid();
                    if (typeof drawDragPreview === 'function') drawDragPreview();
                    break;
                case 6: if (typeof drawKineticLetters === 'function') drawKineticLetters(); break;
                case 7: if (typeof drawColorBurst === 'function') drawColorBurst(); break;
                case 8: if (typeof drawLetterGravity === 'function') drawLetterGravity(); break;
                case 9: if (typeof drawShapeTrails === 'function') drawShapeTrails(); break;
            }
        }

        // Mouse events - Enhanced debugging for mobile
        function mousePressed() {
            console.log("🖱️ mousePressed() called");
            console.log("Mouse position:", mouseX, mouseY);
            console.log("Canvas size:", width, height);
            console.log("Current sketch:", currentSketch);
            
            // More lenient bounds checking for mobile touch
            if (mouseX < -10 || mouseX > width + 10 || mouseY < -10 || mouseY > height + 10) {
                console.log("❌ Mouse outside bounds, ignoring");
                return;
            }
            
            console.log("✅ Mouse within bounds, processing sketch", currentSketch);
            
            switch(currentSketch) {
                case 1: 
                    console.log("Calling drawBasicShape");
                    if (typeof drawBasicShape === 'function') {
                        drawBasicShape(); 
                        console.log("✅ drawBasicShape called successfully");
                    } else {
                        console.log("❌ drawBasicShape function not found");
                    }
                    break;
                case 2: if (typeof clickLetterTypography === 'function') clickLetterTypography(); break;
                case 5: if (typeof startPatternRect === 'function') startPatternRect(); break;
                case 7: if (typeof startColorBurst === 'function') startColorBurst(); break;
                default:
                    console.log("No action defined for sketch", currentSketch);
            }
        }

        function mouseDragged() {
            // More lenient bounds checking for mobile touch
            if (mouseX < -10 || mouseX > width + 10 || mouseY < -10 || mouseY > height + 10) return;
            
            switch(currentSketch) {
                case 3: if (typeof createMondrianCollage === 'function') createMondrianCollage(); break;
                case 4: if (typeof createMagneticLetter === 'function') createMagneticLetter(); break;
                case 6: if (typeof createKineticLetter === 'function') createKineticLetter(); break;
                case 8: if (typeof createGravityLetter === 'function') createGravityLetter(); break;
                case 9: if (typeof createShapeTrail === 'function') createShapeTrail(); break;
                case 10: if (typeof placeLetterMosaic === 'function') placeLetterMosaic(); break;
            }
        }

        function mouseReleased() {
            if (currentSketch === 5 && typeof createPatternRect === 'function') createPatternRect();
            if (currentSketch === 7 && typeof endColorBurst === 'function') endColorBurst();
        }

        // Simplified touch handlers - Let p5.js handle it
        function touchStarted() {
            console.log("👆 Touch started, touches:", touches.length, "sketch:", currentSketch);
            console.log("Touch position:", touches[0] ? touches[0].x + ", " + touches[0].y : "none");
            
            // Visual feedback - draw a red circle where touch occurred
            if (touches.length === 1) {
                fill('red');
                noStroke();
                circle(touches[0].x, touches[0].y, 20);
                console.log("🔴 Drew red circle at touch position");
            }
            
            // Special case for sketch 10 pinch
            if (currentSketch === 10 && touches.length === 2) {
                console.log("Sketch 10 pinch - letting sketch handle");
                return false;
            }
            
            // For all other cases, let p5.js handle but don't prevent default
            console.log("Letting p5.js handle touch event");
        }

        function touchMoved() {
            // Special case for sketch 10 pinch
            if (currentSketch === 10 && touches.length === 2) {
                return false;
            }
            
            // For single touch, let p5.js handle but prevent page scroll
            if (touches.length === 1) {
                return false; // Prevent scrolling while dragging
            }
        }

        function touchEnded() {
            console.log("Touch ended");
            
            // Special case for sketch 10
            if (currentSketch === 10) {
                return false;
            }
        }

        // Mobile-specific optimizations - Enhanced
        function setupMobileOptimizations() {
            console.log("Setting up mobile optimizations...");
            
            // Check if we're on a mobile device
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            console.log("Mobile detected:", isMobile);
            
            // Optimize for high DPI screens
            if (window.devicePixelRatio > 1) {
                console.log("High DPI detected:", window.devicePixelRatio);
            }
            
            // Ensure canvas has proper touch settings
            const canvas = document.querySelector('canvas');
            if (canvas) {
                canvas.style.touchAction = 'none';
                console.log("Canvas touch settings applied");
            }
            
            console.log("Mobile optimizations complete");
        }

        // Fix mouse wheel for sketch 10
        function mouseWheel(event) {
            if (currentSketch === 10 && mouseX >= 0 && mouseX <= width && mouseY >= 0 && mouseY <= height) {
                if (typeof cellSize !== 'undefined') {
                    cellSize += event.delta > 0 ? -5 : 5;
                    cellSize = constrain(cellSize, 10, 100);
                }
                return false; // Prevent page scroll
            }
        }

        // Improved resize handling for mobile
        function windowResized() {
            if (!isFullscreen) {
                // Debounce resize on mobile for better performance
                clearTimeout(window.resizeTimer);
                window.resizeTimer = setTimeout(() => {
                    updateCanvasSize();
                    resizeCanvas(canvasWidth, canvasHeight);
                    background("#FFFFFF");
                    console.log("Canvas resized:", canvasWidth, "x", canvasHeight);
                }, 100);
            }
        }

        // Handle orientation change on mobile
        window.addEventListener('orientationchange', function() {
            setTimeout(() => {
                if (!isFullscreen) {
                    windowResized();
                }
            }, 300); // Wait for orientation change to complete
        });

        // Load sketch
        function loadSketch() {
            currentSketch = parseInt(document.getElementById('sketchSelect').value);
            
            let data = sketchData[currentSketch];
            document.getElementById('sketchTitle').textContent = data.title;
            document.getElementById('sketchDescription').textContent = data.description;
            
            background("#FFFFFF");
            
            // Reset everything
            letters = [];
            shapes = [];
            lettersList = [];
            startX = 0; startY = 0;
            isDrawing = false;
            
            // Initialize sketch
            const initFunc = `initializeSketch${currentSketch}`;
            if (typeof window[initFunc] === 'function') {
                window[initFunc]();
            }
        }

        // Utility functions
        function clearCanvas() {
            background("#FFFFFF");
            letters = []; shapes = []; lettersList = [];
            startX = 0; startY = 0; isDrawing = false;
        }

        function saveCanvasImage() {
            const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
            saveCanvas(`stilj-generator-sketch${currentSketch}-${timestamp}`, "png");
        }

        // Test function to verify drawing works without touch
        function testDraw() {
            console.log("🎨 Test draw button clicked");
            console.log("Current sketch:", currentSketch);
            
            // Draw a test shape directly
            console.log("Drawing test shape at canvas center");
            
            // Simple test shape
            fill('blue');
            stroke('black');
            strokeWeight(3);
            let testX = width/2;
            let testY = height/2;
            circle(testX, testY, 50);
            
            console.log("✅ Test blue circle drawn at center");
            
            // Also test if the sketch function exists
            if (currentSketch === 1 && typeof drawBasicShape === 'function') {
                console.log("✅ drawBasicShape function exists");
            } else {
                console.log("❌ drawBasicShape function missing or not sketch 1");
            }
        }
    </script>
</body>
</html> 